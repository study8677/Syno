{% extends "base.html" %}
{% block title %}人格广场 · Syno{% endblock %}
{% block content %}
<section class="col-span-12 md:col-span-8 space-y-4">
  <div class="flex items-center justify-between">
    <h1 class="text-2xl font-semibold">人格广场</h1>
    <div class="flex items-center gap-2">
      <form method="get" action="/personas" class="hidden md:flex items-center gap-2">
        <input type="hidden" name="sort" value="{{ sort }}" />
        <input name="q" value="{{ q or '' }}" class="w-56 rounded-full border border-gray-200 bg-gray-100 px-3 py-2 text-sm focus:border-brand" placeholder="搜索名称/提示词" />
        <label class="text-sm text-gray-600 flex items-center gap-1"><input type="checkbox" name="mine" value="1" {% if mine %}checked{% endif %}/> 只看我的</label>
        <button class="px-3 py-2 rounded-full border border-gray-200 bg-white hover:bg-gray-50 text-sm" type="submit">筛选</button>
      </form>
      {% if user %}
        <a href="/personas/share" class="inline-flex items-center px-3 py-1.5 rounded-full bg-brand text-white hover:bg-brand2">分享我的人格</a>
      {% else %}
        <a class="text-sm text-brand" href="/login">登录后分享</a>
      {% endif %}
    </div>
  </div>
  <div class="flex items-center gap-5 text-sm">
    <a href="/personas?sort=hot{% if q %}&q={{ q }}{% endif %}{% if mine %}&mine=1{% endif %}" class="py-1 {{ 'text-brand border-b-2 border-brand' if sort=='hot' else 'text-gray-600 hover:text-gray-900' }}">热度</a>
    <a href="/personas?sort=new{% if q %}&q={{ q }}{% endif %}{% if mine %}&mine=1{% endif %}" class="py-1 {{ 'text-brand border-b-2 border-brand' if sort=='new' else 'text-gray-600 hover:text-gray-900' }}">最新</a>
  </div>

  {% if items %}
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      {% for it in items %}
        <article class="rounded-2xl border border-gray-200 bg-white p-5">
          <div class="flex items-start justify-between gap-3">
            <div>
              <div class="font-semibold text-[16px] leading-6">{{ it.name }}</div>
              <div class="text-xs text-gray-500 mt-0.5">@{{ it.owner.username if it.owner else '匿名' }} · 使用 {{ it.uses }} · 赞同 {{ it.likes }}</div>
            </div>
            <form method="post" action="/personas/{{ it.id }}/like">
              <button class="px-3 py-1.5 rounded-full border {{ 'border-brand text-brand' if it.liked else 'border-gray-300' }} bg-white hover:bg-gray-50 text-sm" type="submit">{{ '已赞' if it.liked else '赞同' }}</button>
            </form>
          </div>
          <pre class="whitespace-pre-wrap text-gray-800 mt-3 text-sm">{{ it.prompt }}</pre>
          <div class="mt-4 flex items-center gap-2">
            <form method="post" action="/personas/{{ it.id }}/use">
              <button class="px-3 py-1.5 rounded-full bg-brand text-white hover:bg-brand2 text-sm" type="submit">一键使用</button>
            </form>
            <button class="px-3 py-1.5 rounded-full border border-gray-300 bg-white hover:bg-gray-50 text-sm" onclick="navigator.clipboard.writeText(this.dataset.t)||0" data-t="{{ it.prompt | replace('\n', '\\n') }}">复制提示词</button>
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <div class="rounded-xl border border-gray-200 bg-white p-6 text-gray-600">还没有公开人格，去分享一个吧。</div>
  {% endif %}
</section>

<aside class="col-span-12 md:col-span-4 space-y-4">
  <div class="rounded-xl border border-gray-200 bg-white p-5 text-sm text-gray-600">
    分享你的人格提示词，帮助其他人获得更好的多样化回答。
  </div>
</aside>
{% endblock %}
